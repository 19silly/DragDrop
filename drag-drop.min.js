/**
 * DragDrop.js
 *
 * A JavaScript micro-framework for adding drag-and-drop functionality
 * to elements for advanced UI development.
 *
 * @author     James Brumond
 * @version    0.3.1
 * @copyright  Copyright 2011 James Brumond
 * @license    Dual licensed under MIT and GPL
 *//*jshint browser: true, bitwise: false, camelcase: false, eqnull: true, latedef: false,
  plusplus: false, jquery: true, shadow: true, smarttabs: true, loopfunc: true */(function(){function r(a){var b=0,c=0;if(a.targetTouches)b=a.targetTouches[0].pageX,c=a.targetTouches[0].pageY;else if(a.pageX||a.pageY)b=a.pageX,c=a.pageY;else if(a.clientX||a.clientY)b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;return{x:b,y:c}}var a="ontouchstart"in window,b="drag",c=function(){var d={},j=a?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},n=[],r=function(a,b){for(var c=0,d=n.length;c<d;c++)if(n[c]&&n[c].element===a&&n[c].anchor===b)return!0;return!1},s=function(a,b,c){n[a._id]&&n[a._id].events[b]&&c(n[a._id].events[b])},t=function(a,b){b=b||{},b.element=a,b.anchor=b.anchor||a,b.boundingBox=b.boundingBox||null,b.releaseAnchors=b.releaseAnchors||[],b.releaseAnchors.unshift(document);return b},u=1,v=function(){this._id=u++};v.prototype.unbind=function(){return c.unbind(this)},v.prototype.bindEvent=function(a,b){return c.bindEvent(this,a,b)},v.prototype.unbindEvent=function(a,b){return c.unbindEvent(this,a,b)},v.prototype.invokeEvent=function(a,b){return c.invokeEvent(this,a,b)},v.prototype.setBoundingBox=function(a){n[this._id].boundingBox=a},d.bind=function(d,e){e=t(d,e);if(!m(e.element))throw new Error("Must give an element to drag");if(g(e.element,"position")==="static")throw new Error("Cannot drag-drop an element with position:static");if(!r(e.element,e.anchor)){var s=new v,u={element:e.element,anchor:e.anchor,releaseAnchors:e.releaseAnchors,dragging:!1,event:null,shouldUnbind:!1,boundingBox:e.boundingBox,events:{beforedrag:o(e.beforedrag),dragstart:o(e.dragstart),dragend:o(e.dragend),drag:o(e.drag),unbind:o(e.unbind)}};u.event=q.bind(u.anchor,j.start,function(d){function x(a){return function(d){for(var e=0,f=r.length;e<f;e++)q.unbind(r[e]);u.dragging=!1,k(u.element,b),u.shouldUnbind&&c.unbind(u.element,u.anchor),u.events.dragend.call(u.element,new p("dragend",d,u,{releaseAnchor:a}));return i(d)}}if(window.event&&d.button===1||d.button===0||a){i(d),u.events.beforedrag.call(u.element,new p("beforedrag",d,u)),u.dragging=!0,l(u.element,b);var e=f(u.element,"left"),m=f(u.element,"top"),n=u.element.offsetLeft,o=u.element.offsetTop,r=[],s=a?u.anchor:document;r.push(q.bind(s,j.move,function(a){var b=a.clientX-d.clientX,c=a.clientY-d.clientY,f=u.element.offsetWidth,j=u.element.offsetHeight,k=e+b,l=m+c;if(u.boundingBox){var q=u.boundingBox,r,s,t,v;if(q==="offsetParent"){var w=u.element.offsetParent;g(u.element,"position")==="relative"?(r=-n,t=-o):r=t=0,s=w.offsetWidth+r,v=w.offsetHeight+t}else if(q==="windowSize"){var x=h();r=t=0,s=x.x,v=x.y}else r=q.x.min,s=q.x.max,t=q.y.min,v=q.y.max;k=Math.max(r,Math.min(s-f,k)),l=Math.max(t,Math.min(v-j,l))}u.element.style.left=k+"px",u.element.style.top=l+"px",u.events.drag.call(u.element,new p("drag",a,u));return i(a)}));for(var t=0,v=u.releaseAnchors.length;t<v;t++){var w=u.releaseAnchors[t];r.push(q.bind(w,j.end,x(w)))}document.body.focus(),r.push(q.bind(document,"selectstart",!1)),r.push(q.bind(u.anchor,"dragstart",!1)),u.events.dragstart.call(u.element,new p("dragstart",d,u));return!1}}),n[s._id]=u;return s}},d.unbind=function(a){if(a instanceof v){var b=a._id;n[b]&&(n[b].dragging?n[b].shouldUnbind=!0:(q.unbind(n[b].event),n[b]=null),binding.events.unbind.call(binding.element,new p("unbind",e,binding)))}},d.bindEvent=function(a,b,c){s(a,b,function(a){a.push(c)})},d.unbindEvent=function(a,b,c){s(a,b,function(a){a.remove(c)})},d.invokeEvent=function(a,b,c){s(a,b,function(d){d.call(n[a._id].element,new p(b,c,a))})};return d}(),d=function(a,b,c){var d=a.slice((c||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,d)},f=function(a,b){var c=parseFloat(g(a,b));return isNaN(c)?0:c},g=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);if(a.style)return a.style[b]},h=function(){return{x:window.innerWidth||document.documentElement.clientWidth||body().clientWidth,y:window.innerHeight||document.documentElement.clientHeight||body().clientHeight}},i=function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1;return!1},j={},k=function(a,b){j[b]||(j[b]=new RegExp("(^|\\s)+"+b+"(\\s|$)+")),a.className=a.className.replace(j[b]," ")},l=function(a,b){k(a,b),a.className+=" "+b},m=function(a){return!!a&&typeof a=="object"},n=function(a){var b;a.target?b=a.target:a.srcElement&&(b=a.srcElement),b.nodeType===3&&(b=b.parentNode);return b},o=function(a){var b=[],c=function(){var a;for(var c=0,d=b.length;c<d;c++)a=b[c].apply(this,arguments);return a};c.push=function(){b.push.apply(b,arguments)},c.remove=function(){var a=Array.prototype.slice.call(arguments),c=[];OUTER:for(var d=0,e=b.length;d<e;d++){for(var f=0,g=a.length;f<g;f++)if(b[d]===a[f])continue OUTER;c.push(b[d])}b=c},typeof a=="function"&&b.push(a);return c},p=function(b,c,d,e){this.type=b,this.originalEvent=c,this.altKey=c.altKey||!1,this.ctrlKey=c.ctrlKey||!1,this.shiftKey=c.shiftKey||!1,this.timestamp=c.timestamp||+(new Date),this.pos=r(c),this.binding=d,this.target=n(c);if(e)for(var f in e)e.hasOwnProperty(f)&&(this[f]=e[f])},q=function(){var a=function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(){}}(),b=function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,!1)}:document.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(){}}();return{bind:function(c,d,e){var f=e===!1?function(a){return i(a)}:e;e=function(a){return f.call(c,a||window.event)},a(c,d,e);var g=function(){b(c,d,e)};g.unbind=function(){g()};return g},unbind:function(a){a()}}}();window.DragDrop=c})()
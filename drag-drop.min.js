/**
 * DragDrop.js
 *
 * A JavaScript micro-framework for adding drag-and-drop functionality
 * to elements for advanced UI development.
 *
 * @author     James Brumond
 * @version    0.1.2-beta
 * @copyright  Copyright 2011 James Brumond
 * @license    Dual licensed under MIT and GPL
 */(function(){var a=!0,b=function(){var a,b=document.createElement("div");a="ontouchstart"in b,b=null;return a}(),c="drag",d=new function(){var g=this,i=function(){return b?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"}}(),o=[],p=function(a,b){for(var c=0,d=o.length;c<d;c++)if(o[c].elem===a&&o[c].anchor===b)return[c,o[c]];return!1},q=function(a,b,c){var d=p(a,b);d&&c(d)},r=function(a,b,c,d){q(a,b,function(a){a[1].events.hasOwnProperty(c)&&d(a[1].events[c])})};this.bind=function(b,e,g){if(typeof b=="object"&&b){e=e||b;if(!p(b,e)){var q={elem:b,anchor:e,dragging:!1,event:null,shouldUnbind:!1,events:{dragstart:l(g&&g.dragstart),dragend:l(g&&g.dragend),drag:l(g&&g.drag)}};q.event=n.bind(e,i.start,function(a){if(window.event&&a.button===1||a.button===0){q.dragging=!0,k(b,c);var g=f(b,"left"),l=f(b,"top"),o=[];o.push(n.bind(document,i.move,function(c){var d=c.clientX-a.clientX,e=c.clientY-a.clientY;b.style.left=g+d+"px",b.style.top=l+e+"px",q.events.drag.call(b,new m("drag",c));return h(c)})),o.push(n.bind(document,i.end,function(a){for(var f=0,g=o.length;f<g;f++)n.unbind(o[f]);q.dragging=!1,j(b,c),q.shouldUnbind&&d.unbind(b,e),q.events.dragend.call(b,new m("dragend",a));return h(a)})),document.body.focus(),o.push(n.bind(document,"selectstart",!1)),o.push(n.bind(e,"dragstart",!1)),q.events.dragstart.call(b,new m("dragstart",a));return h(a)}}),o.push(q)}}else if(a){var r=typeof b;r=r==="object"?"NULL":'"'+r+'"';throw new TypeError('DragDrop.bind: argument 1 expects type "object", '+r+" given.")}},this.unbind=function(b,c){if(typeof b=="object"&&b){var d=p(b,c),f;d&&(f=d[0],d=d[1],d.dragging?d.shouldUnbind=!0:(n.unbind(d.event),e(o,f)))}else if(a){var g=typeof b;g=g==="object"?"NULL":'"'+g+'"';throw new TypeError('DragDrop.unbind: argument 1 expects type "object", '+g+" given.")}},this.bindEvent=function(a,b,c,d){r(a,b,c,function(a){a.push(d)})},this.unbindEvent=function(a,b,c,d){r(a,b,c,function(a){a.remove(d)})},this.invokeEvent=function(a,b,c,d){r(a,b,c,function(b){b.call(a,new m(c,d))})}},e=function(a,b,c){var d=a.slice((c||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,d)},f=function(a,b){var c=parseFloat(g(a,b));return isNaN(c)?0:c},g=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);if(a.style)return a.style[b]},h=function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1;return!1},i={},j=function(a,b){i[b]||(i[b]=new RegExp("(^|\\s)+"+b+"(\\s|$)+")),a.className=a.className.replace(i[b]," ")},k=function(a,b){j(a,b),a.className+=" "+b},l=function(a){var b=[],c=function(){var a;for(var c=0,d=b.length;c<d;c++)a=b[c].apply(this,arguments);return a};c.push=function(){b.push.apply(b,arguments)},c.remove=function(){var a=Array.prototype.slice.call(arguments),c=[];OUTER:for(var d=0,e=b.length;d<e;d++){for(var f=0,g=a.length;f<g;f++)if(b[d]===a[f])continue OUTER;c.push(b[d])}b=c},typeof a=="function"&&b.push(a);return c},m=function(b,c){this.type=b,this.originalEvent=c,this.altKey=c.altKey||!1,this.ctrlKey=c.ctrlKey||!1,this.shiftKey=c.shiftKey||!1,this.timestamp=c.timestamp||+(new Date)},n=function(){var b=function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(){if(a)throw new Error("DragDrop->Events->bindEvent: Could not bind event. No event binder found.")}}(),c=function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,!1)}:document.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(){if(a)throw new Error("DragDrop->Events->unbindEvent: Could not unbind event. No event unbinder found.")}}();return{bind:function(a,d,e){var f=e===!1?function(a){return h(a)}:e;e=function(b){return f.call(a,b||window.event)},b(a,d,e);var g=function(){c(a,d,e)};g.unbind=function(){g()};return g},unbind:function(a){a()}}}();window.DragDrop=d})()
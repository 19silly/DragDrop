/**
 * DragDrop.js
 *
 * A JavaScript micro-framework for adding drag-and-drop functionality
 * to elements for advanced UI development.
 *
 * @author     James Brumond
 * @version    0.2.2-beta
 * @copyright  Copyright 2011 James Brumond
 * @license    Dual licensed under MIT and GPL
 */(function(){var a=function(){var a,b=document.createElement("div");a="ontouchstart"in b,b=null;return a}(),b="drag",c=function(){var d={},f=a?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},i=[],p=function(a,b){for(var c=0,d=i.length;c<d;c++)if(i.element===a&&i.anchor===b)return!0;return!1},q=function(a,b,c){i[a._id]&&i[a._id].events[b]&&c(i[a._id].events[b])},r=function(a,b){b=b||{},b.element=a,b.anchor=b.anchor||a,b.boundingBox=b.boundingBox||null;return b},s=1,t=function(){this._id=s++};t.prototype.unbind=function(){return c.unbind(this)},t.prototype.bindEvent=function(a,b){return c.bindEvent(this,a,b)},t.prototype.unbindEvent=function(a,b){return c.unbindEvent(this,a,b)},t.prototype.invokeEvent=function(a,b){return c.invokeEvent(this,a,b)},t.prototype.setBoundingBox=function(a){i[this._id].boundingBox=a},d.bind=function(a,d){d=r(a,d);if(l(d.element)&&!p(d.element,d.anchor)){var q=new t,s={element:d.element,anchor:d.anchor,dragging:!1,event:null,shouldUnbind:!1,boundingBox:d.boundingBox,events:{dragstart:m(d.dragstart),dragend:m(d.dragend),drag:m(d.drag)}};s.event=o.bind(s.anchor,f.start,function(a){if(window.event&&a.button===1||a.button===0){s.dragging=!0,k(s.element,b);var i=e(s.element,"left"),l=e(s.element,"top"),m=[];m.push(o.bind(document,f.move,function(b){var c=b.clientX-a.clientX,e=b.clientY-a.clientY,f=s.element.offsetWidth,j=s.element.offsetHeight,k=i+c,m=l+e;if(d.boundingBox){var o=d.boundingBox,p,q,r,t;if(o==="offsetParent"){var u=s.element.offsetParent;p=r=0,q=u.offsetWidth,t=u.offsetHeight}else if(o==="windowSize"){var v=g();console.log(v),p=r=0,q=v.x,t=v.y}else p=o.x.min,q=o.x.max,r=o.y.min,t=o.y.max;k=Math.max(p,Math.min(q-f,k)),m=Math.max(r,Math.min(t-j,m))}s.element.style.left=k+"px",s.element.style.top=m+"px",s.events.drag.call(s.element,new n("drag",b));return h(b)})),m.push(o.bind(document,f.end,function(a){for(var d=0,e=m.length;d<e;d++)o.unbind(m[d]);s.dragging=!1,j(s.element,b),s.shouldUnbind&&c.unbind(s.element,s.anchor),s.events.dragend.call(s.element,new n("dragend",a));return h(a)})),document.body.focus(),m.push(o.bind(document,"selectstart",!1)),m.push(o.bind(s.anchor,"dragstart",!1)),s.events.dragstart.call(s.element,new n("dragstart",a));return h(a)}}),i[q._id]=s;return q}},d.unbind=function(a){if(a instanceof t){var b=a._id;i[b]&&(i[b].dragging?i[b].shouldUnbind=!0:(o.unbind(i[b].event),i[b]=null))}},d.bindEvent=function(a,b,c){q(a,b,function(a){a.push(c)})},d.unbindEvent=function(a,b,c){q(a,b,function(a){a.remove(c)})},d.invokeEvent=function(a,b,c){q(a,b,function(d){d.call(i[a._id].element,new n(b,c))})};return d}(),d=function(a,b,c){var d=a.slice((c||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,d)},e=function(a,b){var c=parseFloat(f(a,b));return isNaN(c)?0:c},f=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);if(a.style)return a.style[b]},g=function(){return{x:window.innerWidth||document.documentElement.clientWidth||body().clientWidth,y:window.innerHeight||document.documentElement.clientHeight||body().clientHeight}},h=function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1;return!1},i={},j=function(a,b){i[b]||(i[b]=new RegExp("(^|\\s)+"+b+"(\\s|$)+")),a.className=a.className.replace(i[b]," ")},k=function(a,b){j(a,b),a.className+=" "+b},l=function(a){return!!a&&typeof a=="object"},m=function(a){var b=[],c=function(){var a;for(var c=0,d=b.length;c<d;c++)a=b[c].apply(this,arguments);return a};c.push=function(){b.push.apply(b,arguments)},c.remove=function(){var a=Array.prototype.slice.call(arguments),c=[];OUTER:for(var d=0,e=b.length;d<e;d++){for(var f=0,g=a.length;f<g;f++)if(b[d]===a[f])continue OUTER;c.push(b[d])}b=c},typeof a=="function"&&b.push(a);return c},n=function(b,c){this.type=b,this.originalEvent=c,this.altKey=c.altKey||!1,this.ctrlKey=c.ctrlKey||!1,this.shiftKey=c.shiftKey||!1,this.timestamp=c.timestamp||+(new Date)},o=function(){var a=function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(){}}(),b=function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,!1)}:document.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(){}}();return{bind:function(c,d,e){var f=e===!1?function(a){return h(a)}:e;e=function(a){return f.call(c,a||window.event)},a(c,d,e);var g=function(){b(c,d,e)};g.unbind=function(){g()};return g},unbind:function(a){a()}}}();window.DragDrop=c})()
/**
 * DragDrop.js
 *
 * A JavaScript micro-framework for adding drag-and-drop functionality
 * to elements for advanced UI development.
 *
 * @author     James Brumond
 * @version    0.2.1-beta
 * @copyright  Copyright 2011 James Brumond
 * @license    Dual licensed under MIT and GPL
 */(function(){var a=function(){var a,b=document.createElement("div");a="ontouchstart"in b,b=null;return a}(),b="drag",c=function(){var d={},f=a?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},h=[],o=function(a,b){for(var c=0,d=h.length;c<d;c++)if(h.element===a&&h.anchor===b)return!0;return!1},p=function(a,b,c){h[a._id]&&h[a._id].events[b]&&c(h[a._id].events[b])},q=function(a,b){b=b||{},b.element=a,b.anchor=b.anchor||a,b.boundingBox=b.boundingBox||null;return b},r=1,s=function(){this._id=r++};s.prototype.unbind=function(){return c.unbind(this)},s.prototype.bindEvent=function(a,b){return c.bindEvent(this,a,b)},s.prototype.unbindEvent=function(a,b){return c.unbindEvent(this,a,b)},s.prototype.invokeEvent=function(a,b){return c.invokeEvent(this,a,b)},s.prototype.setBoundingBox=function(a){h[this._id].boundingBox=a},d.bind=function(a,d){d=q(a,d);if(k(d.element)&&!o(d.element,d.anchor)){var p=new s,r={element:d.element,anchor:d.anchor,dragging:!1,event:null,shouldUnbind:!1,boundingBox:d.boundingBox,events:{dragstart:l(d.dragstart),dragend:l(d.dragend),drag:l(d.drag)}};r.event=n.bind(r.anchor,f.start,function(a){if(window.event&&a.button===1||a.button===0){r.dragging=!0,j(r.element,b);var h=e(r.element,"left"),k=e(r.element,"top"),l=[];l.push(n.bind(document,f.move,function(b){var c=b.clientX-a.clientX,e=b.clientY-a.clientY,f=r.element.offsetWidth,i=r.element.offsetHeight,j=h+c,l=k+e;if(d.boundingBox){var n=d.boundingBox,o,p,q,s;if(n==="offsetParent"){var t=r.element.offsetParent;o=q=0,p=t.offsetWidth,s=t.offsetHeight}else o=n.x.min,p=n.x.max,q=n.y.min,s=n.y.max;j=Math.max(o,Math.min(p-f,j)),l=Math.max(q,Math.min(s-i,l))}r.element.style.left=j+"px",r.element.style.top=l+"px",r.events.drag.call(r.element,new m("drag",b));return g(b)})),l.push(n.bind(document,f.end,function(a){for(var d=0,e=l.length;d<e;d++)n.unbind(l[d]);r.dragging=!1,i(r.element,b),r.shouldUnbind&&c.unbind(r.element,r.anchor),r.events.dragend.call(r.element,new m("dragend",a));return g(a)})),document.body.focus(),l.push(n.bind(document,"selectstart",!1)),l.push(n.bind(r.anchor,"dragstart",!1)),r.events.dragstart.call(r.element,new m("dragstart",a));return g(a)}}),h[p._id]=r;return p}},d.unbind=function(a){if(a instanceof s){var b=a._id;h[b]&&(h[b].dragging?h[b].shouldUnbind=!0:(n.unbind(h[b].event),h[b]=null))}},d.bindEvent=function(a,b,c){p(a,b,function(a){a.push(c)})},d.unbindEvent=function(a,b,c){p(a,b,function(a){a.remove(c)})},d.invokeEvent=function(a,b,c){p(a,b,function(d){d.call(h[a._id].element,new m(b,c))})};return d}(),d=function(a,b,c){var d=a.slice((c||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,d)},e=function(a,b){var c=parseFloat(f(a,b));return isNaN(c)?0:c},f=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);if(a.style)return a.style[b]},g=function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1;return!1},h={},i=function(a,b){h[b]||(h[b]=new RegExp("(^|\\s)+"+b+"(\\s|$)+")),a.className=a.className.replace(h[b]," ")},j=function(a,b){i(a,b),a.className+=" "+b},k=function(a){return!!a&&typeof a=="object"},l=function(a){var b=[],c=function(){var a;for(var c=0,d=b.length;c<d;c++)a=b[c].apply(this,arguments);return a};c.push=function(){b.push.apply(b,arguments)},c.remove=function(){var a=Array.prototype.slice.call(arguments),c=[];OUTER:for(var d=0,e=b.length;d<e;d++){for(var f=0,g=a.length;f<g;f++)if(b[d]===a[f])continue OUTER;c.push(b[d])}b=c},typeof a=="function"&&b.push(a);return c},m=function(b,c){this.type=b,this.originalEvent=c,this.altKey=c.altKey||!1,this.ctrlKey=c.ctrlKey||!1,this.shiftKey=c.shiftKey||!1,this.timestamp=c.timestamp||+(new Date)},n=function(){var a=function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(){}}(),b=function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,!1)}:document.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(){}}();return{bind:function(c,d,e){var f=e===!1?function(a){return g(a)}:e;e=function(a){return f.call(c,a||window.event)},a(c,d,e);var h=function(){b(c,d,e)};h.unbind=function(){h()};return h},unbind:function(a){a()}}}();window.DragDrop=c})()
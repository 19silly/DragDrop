/**
 * DragDrop.js
 *
 * A JavaScript micro-framework for adding drag-and-drop functionality
 * to elements for advanced UI development.
 *
 * @author     James Brumond
 * @version    0.2.3-beta
 * @copyright  Copyright 2011 James Brumond
 * @license    Dual licensed under MIT and GPL
 */(function(){var a=function(){var a,b=document.createElement("div");a="ontouchstart"in b,b=null;return a}(),b="drag",c=function(){var d={},g=a?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},j=[],q=function(a,b){for(var c=0,d=j.length;c<d;c++)if(j.element===a&&j.anchor===b)return!0;return!1},r=function(a,b,c){j[a._id]&&j[a._id].events[b]&&c(j[a._id].events[b])},s=function(a,b){b=b||{},b.element=a,b.anchor=b.anchor||a,b.boundingBox=b.boundingBox||null;return b},t=1,u=function(){this._id=t++};u.prototype.unbind=function(){return c.unbind(this)},u.prototype.bindEvent=function(a,b){return c.bindEvent(this,a,b)},u.prototype.unbindEvent=function(a,b){return c.unbindEvent(this,a,b)},u.prototype.invokeEvent=function(a,b){return c.invokeEvent(this,a,b)},u.prototype.setBoundingBox=function(a){j[this._id].boundingBox=a},d.bind=function(a,d){d=s(a,d);if(m(d.element)&&!q(d.element,d.anchor)){var e=new u,r={element:d.element,anchor:d.anchor,dragging:!1,event:null,shouldUnbind:!1,boundingBox:d.boundingBox,events:{beforedrag:n(d.beforedrag),dragstart:n(d.dragstart),dragend:n(d.dragend),drag:n(d.drag),unbind:n(d.unbind)}};r.event=p.bind(r.anchor,g.start,function(a){if(window.event&&a.button===1||a.button===0){r.events.beforedrag.call(r.element,new o("beforedrag",a)),r.dragging=!0,l(r.element,b);var e=f(r.element,"left"),j=f(r.element,"top"),m=[];m.push(p.bind(document,g.move,function(b){var c=b.clientX-a.clientX,f=b.clientY-a.clientY,g=r.element.offsetWidth,k=r.element.offsetHeight,l=e+c,m=j+f;if(d.boundingBox){var n=d.boundingBox,p,q,s,t;if(n==="offsetParent"){var u=r.element.offsetParent;p=s=0,q=u.offsetWidth,t=u.offsetHeight}else if(n==="windowSize"){var v=h();p=s=0,q=v.x,t=v.y}else p=n.x.min,q=n.x.max,s=n.y.min,t=n.y.max;l=Math.max(p,Math.min(q-g,l)),m=Math.max(s,Math.min(t-k,m))}r.element.style.left=l+"px",r.element.style.top=m+"px",r.events.drag.call(r.element,new o("drag",b));return i(b)})),m.push(p.bind(document,g.end,function(a){for(var d=0,e=m.length;d<e;d++)p.unbind(m[d]);r.dragging=!1,k(r.element,b),r.shouldUnbind&&c.unbind(r.element,r.anchor),r.events.dragend.call(r.element,new o("dragend",a));return i(a)})),document.body.focus(),m.push(p.bind(document,"selectstart",!1)),m.push(p.bind(r.anchor,"dragstart",!1)),r.events.dragstart.call(r.element,new o("dragstart",a));return i(a)}}),j[e._id]=r;return e}},d.unbind=function(a){if(a instanceof u){var b=a._id;j[b]&&(j[b].dragging?j[b].shouldUnbind=!0:(p.unbind(j[b].event),j[b]=null),binding.events.unbind.call(binding.element,new o("unbind",e)))}},d.bindEvent=function(a,b,c){r(a,b,function(a){a.push(c)})},d.unbindEvent=function(a,b,c){r(a,b,function(a){a.remove(c)})},d.invokeEvent=function(a,b,c){r(a,b,function(d){d.call(j[a._id].element,new o(b,c))})};return d}(),d=function(a,b,c){var d=a.slice((c||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,d)},f=function(a,b){var c=parseFloat(g(a,b));return isNaN(c)?0:c},g=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);if(a.style)return a.style[b]},h=function(){return{x:window.innerWidth||document.documentElement.clientWidth||body().clientWidth,y:window.innerHeight||document.documentElement.clientHeight||body().clientHeight}},i=function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1;return!1},j={},k=function(a,b){j[b]||(j[b]=new RegExp("(^|\\s)+"+b+"(\\s|$)+")),a.className=a.className.replace(j[b]," ")},l=function(a,b){k(a,b),a.className+=" "+b},m=function(a){return!!a&&typeof a=="object"},n=function(a){var b=[],c=function(){var a;for(var c=0,d=b.length;c<d;c++)a=b[c].apply(this,arguments);return a};c.push=function(){b.push.apply(b,arguments)},c.remove=function(){var a=Array.prototype.slice.call(arguments),c=[];OUTER:for(var d=0,e=b.length;d<e;d++){for(var f=0,g=a.length;f<g;f++)if(b[d]===a[f])continue OUTER;c.push(b[d])}b=c},typeof a=="function"&&b.push(a);return c},o=function(b,c){this.type=b,this.originalEvent=c,this.altKey=c.altKey||!1,this.ctrlKey=c.ctrlKey||!1,this.shiftKey=c.shiftKey||!1,this.timestamp=c.timestamp||+(new Date)},p=function(){var a=function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(){}}(),b=function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,!1)}:document.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(){}}();return{bind:function(c,d,e){var f=e===!1?function(a){return i(a)}:e;e=function(a){return f.call(c,a||window.event)},a(c,d,e);var g=function(){b(c,d,e)};g.unbind=function(){g()};return g},unbind:function(a){a()}}}();window.DragDrop=c})()